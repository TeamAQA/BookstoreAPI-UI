<div class="main-content">
  <div class="container">
    <div class="page-header">
      <h1 class="page-title">üìö Books Management</h1>
      
      <div class="header-actions">
        <div class="search-bar">
          <input 
            type="text" 
            class="search-input" 
            placeholder="Search by title or author..."
            [(ngModel)]="searchQuery"
            (input)="onSearch()"
          >
          <button class="btn-search" (click)="onSearch()">üîç</button>
        </div>
        
        <button class="btn-add" (click)="openAddModal()">
          ‚ûï Add New Book
        </button>
      </div>
    </div>

    <div *ngIf="loading" class="loading">
      Loading books...
    </div>

    <div *ngIf="!loading && filteredBooks.length === 0" class="no-results">
      <p>No books found.</p>
    </div>

    <div *ngIf="!loading && filteredBooks.length > 0" class="books-table-container">
      <table class="books-table">
        <thead>
          <tr>
            <th>ID</th>
            <th>Cover</th>
            <th>Title</th>
            <th>Authors</th>
            <th>Year</th>
            <th>Price</th>
            <th>Available</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let book of filteredBooks">
            <td>{{ book.id }}</td>
            <td>
              <div class="table-book-cover">
                <img *ngIf="book.coverUrl" [src]="book.coverUrl" alt="{{ book.title }}">
                <span *ngIf="!book.coverUrl">üìö</span>
              </div>
            </td>
            <td class="book-title-cell">{{ book.title }}</td>
            <td class="authors-cell">{{ getAuthorsText(book.authors) }}</td>
            <td>{{ book.year || 'N/A' }}</td>
            <td class="price-cell">${{ book.price.toFixed(2) }}</td>
            <td>
              <span [class]="book.available > 10 ? 'stock-high' : book.available > 0 ? 'stock-low' : 'stock-out'">
                {{ book.available }}
              </span>
            </td>
            <td class="actions-cell">
              <button class="btn-icon btn-edit" (click)="openEditModal(book)" title="Edit">
                ‚úèÔ∏è
              </button>
              <button class="btn-icon btn-delete" (click)="openDeleteModal(book)" title="Delete">
                üóëÔ∏è
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- Add Book Modal -->
<div class="modal" [class.active]="showAddModal">
  <div class="modal-content modal-large">
    <div class="modal-header">
      <h3>‚ûï Add New Book</h3>
      <button class="btn-close" (click)="closeAddModal()">&times;</button>
    </div>
    
    <div class="modal-body">
      <form (submit)="addBook(); $event.preventDefault()">
        <div class="form-row">
          <div class="form-group">
            <label for="title">Title *</label>
            <input 
              type="text" 
              id="title" 
              class="form-input" 
              [(ngModel)]="bookForm.title"
              name="title"
              required
            >
          </div>
          
          <div class="form-group">
            <label for="year">Year *</label>
            <input 
              type="number" 
              id="year" 
              class="form-input" 
              [(ngModel)]="bookForm.year"
              name="year"
              min="1800"
              [max]="2100"
              required
            >
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="price">Price ($) *</label>
            <input 
              type="number" 
              id="price" 
              class="form-input" 
              [(ngModel)]="bookForm.price"
              name="price"
              step="0.01"
              min="0.01"
              required
            >
          </div>
          
          <div class="form-group">
            <label for="available">Available Quantity *</label>
            <input 
              type="number" 
              id="available" 
              class="form-input" 
              [(ngModel)]="bookForm.available"
              name="available"
              min="0"
              required
            >
          </div>
        </div>
        
        <div class="form-group">
          <label>Authors * (select at least one)</label>
          <div class="authors-selection">
            <div 
              *ngFor="let author of authors" 
              class="author-checkbox"
              [class.selected]="isAuthorSelected(author.id)"
              (click)="toggleAuthorSelection(author.id)"
            >
              <input 
                type="checkbox" 
                [checked]="isAuthorSelected(author.id)"
                (click)="$event.stopPropagation()"
              >
              <span>{{ getAuthorName(author) }}</span>
            </div>
          </div>
        </div>
        
        <div class="modal-actions">
          <button type="button" class="btn-secondary" (click)="closeAddModal()">
            Cancel
          </button>
          <button type="submit" class="btn-primary">
            Add Book
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Edit Book Modal -->
<div class="modal" [class.active]="showEditModal">
  <div class="modal-content modal-large">
    <div class="modal-header">
      <h3>‚úèÔ∏è Edit Book</h3>
      <button class="btn-close" (click)="closeEditModal()">&times;</button>
    </div>
    
    <div class="modal-body">
      <form (submit)="updateBook(); $event.preventDefault()">
        <div class="form-row">
          <div class="form-group">
            <label for="editTitle">Title *</label>
            <input 
              type="text" 
              id="editTitle" 
              class="form-input" 
              [(ngModel)]="bookForm.title"
              name="editTitle"
              required
            >
          </div>
          
          <div class="form-group">
            <label for="editYear">Year *</label>
            <input 
              type="number" 
              id="editYear" 
              class="form-input" 
              [(ngModel)]="bookForm.year"
              name="editYear"
              min="1800"
              [max]="2100"
              required
            >
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="editPrice">Price ($) *</label>
            <input 
              type="number" 
              id="editPrice" 
              class="form-input" 
              [(ngModel)]="bookForm.price"
              name="editPrice"
              step="0.01"
              min="0.01"
              required
            >
          </div>
          
          <div class="form-group">
            <label for="editAvailable">Available Quantity *</label>
            <input 
              type="number" 
              id="editAvailable" 
              class="form-input" 
              [(ngModel)]="bookForm.available"
              name="editAvailable"
              min="0"
              required
            >
          </div>
        </div>
        
        <div class="form-group">
          <label>Authors * (select at least one)</label>
          <div class="authors-selection">
            <div 
              *ngFor="let author of authors" 
              class="author-checkbox"
              [class.selected]="isAuthorSelected(author.id)"
              (click)="toggleAuthorSelection(author.id)"
            >
              <input 
                type="checkbox" 
                [checked]="isAuthorSelected(author.id)"
                (click)="$event.stopPropagation()"
              >
              <span>{{ getAuthorName(author) }}</span>
            </div>
          </div>
        </div>
        
        <div class="modal-actions">
          <button type="button" class="btn-secondary" (click)="closeEditModal()">
            Cancel
          </button>
          <button type="submit" class="btn-primary">
            Update Book
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal" [class.active]="showDeleteModal">
  <div class="modal-content modal-small">
    <div class="modal-header">
      <h3>‚ö†Ô∏è Delete Book</h3>
      <button class="btn-close" (click)="closeDeleteModal()">&times;</button>
    </div>
    
    <div class="modal-body">
      <p class="delete-warning">
        Are you sure you want to delete <strong>{{ selectedBook?.title }}</strong>?
      </p>
      <p class="delete-note">
        This action cannot be undone. If this book is part of existing orders, the deletion will fail.
      </p>
      
      <div class="modal-actions">
        <button type="button" class="btn-secondary" (click)="closeDeleteModal()">
          Cancel
        </button>
        <button type="button" class="btn-danger" (click)="deleteBook()">
          Delete Book
        </button>
      </div>
    </div>
  </div>
</div>
